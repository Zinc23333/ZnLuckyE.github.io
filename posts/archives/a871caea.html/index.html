<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.znluckye.top",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="0.效果预览最近在B站上看到很多用墨水屏制作的天气预报站，自己也很想做一个，所以趁现在才高二，决定在玩一把，高三就好好学习（可能吗emmmm） 1.材料 4.2寸墨水屏（裸屏）(4.2inch e-Paper Module (B))（￥126） ESP8266驱动板(E-Paper ESP8266 Driver Board)（￥73） 2000mah电池（￥10） 充电模块（￥2） 开关，按钮，导"><meta property="og:type" content="article"><meta property="og:title" content="墨水屏天气预报站"><meta property="og:url" content="https://blog.znluckye.top/posts/archives/a871caea.html/index.html"><meta property="og:site_name" content="ヾ(•ω•&#96;)o"><meta property="og:description" content="0.效果预览最近在B站上看到很多用墨水屏制作的天气预报站，自己也很想做一个，所以趁现在才高二，决定在玩一把，高三就好好学习（可能吗emmmm） 1.材料 4.2寸墨水屏（裸屏）(4.2inch e-Paper Module (B))（￥126） ESP8266驱动板(E-Paper ESP8266 Driver Board)（￥73） 2000mah电池（￥10） 充电模块（￥2） 开关，按钮，导"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="d:/qiany/blog_pictures/002/03.png"><meta property="og:image" content="https://pic.imgdb.cn/item/611f1c204907e2d39cc4cadf.png"><meta property="og:image" content="d:/qiany/blog_pictures/002/04.png"><meta property="article:published_time" content="2021-07-26T10:14:21.000Z"><meta property="article:modified_time" content="2021-08-27T13:13:56.233Z"><meta property="article:author" content="ZnLuckyE"><meta property="article:tag" content="高中"><meta property="article:tag" content="DIY"><meta property="article:tag" content="教程"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="d:/qiany/blog_pictures/002/03.png"><link rel="canonical" href="https://blog.znluckye.top/posts/archives/a871caea.html/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>墨水屏天气预报站 | ヾ(•ω•`)o</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">ヾ(•ω•`)o</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/ZnLuckyE" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.znluckye.top/posts/archives/a871caea.html/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="ZnLuckyE"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ヾ(•ω•`)o"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">墨水屏天气预报站</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-07-26 18:14:21" itemprop="dateCreated datePublished" datetime="2021-07-26T18:14:21+08:00">2021-07-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-08-27 21:13:56" itemprop="dateModified" datetime="2021-08-27T21:13:56+08:00">2021-08-27</time> </span><span id="/posts/archives/a871caea.html/" class="post-meta-item leancloud_visitors" data-flag-title="墨水屏天气预报站" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>13k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="0-效果预览"><a href="#0-效果预览" class="headerlink" title="0.效果预览"></a>0.效果预览</h2><p>最近在B站上看到很多用墨水屏制作的天气预报站，自己也很想做一个，所以趁现在才高二，决定在玩一把，高三就好好学习（可能吗emmmm）</p><h2 id="1-材料"><a href="#1-材料" class="headerlink" title="1.材料"></a>1.材料</h2><ul><li>4.2寸墨水屏（裸屏）(<a target="_blank" rel="noopener" href="https://www.waveshare.net/wiki/4.2inch_e-Paper_Module_(B)">4.2inch e-Paper Module (B)</a>)（￥126）</li><li>ESP8266驱动板(<a target="_blank" rel="noopener" href="https://www.waveshare.net/wiki/E-Paper_ESP8266_Driver_Board">E-Paper ESP8266 Driver Board</a>)（￥73）</li><li>2000mah电池（￥10）</li><li>充电模块（￥2）</li><li>开关，按钮，导线若干（约￥15）</li></ul><h2 id="2-代码"><a href="#2-代码" class="headerlink" title="2.代码"></a>2.代码</h2><h3 id="2-1-库"><a href="#2-1-库" class="headerlink" title="2.1 库"></a>2.1 库</h3><p>需要库文件：</p><ul><li><code>ESP8266WiFi.h</code> （安装过程百度）</li><li><code>ESP8266_Seniverse.h</code>(<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-platform/seniverse/esp8266-seniverse-library/">ESP8266-Seniverse库使用说明</a>)</li><li><code>NTPClient.h</code> 获取网络时间 （直接在Arduino 管理库 中搜索安装）</li><li><code>WiFiUdp.h</code> （直接在Arduino 管理库 中搜索安装）</li><li><code>esp8266-waveshare-epd</code> (<a target="_blank" rel="noopener" href="https://www.waveshare.net/w/upload/d/d5/E-Paper_ESP8266_Driver_Board_Code.7z">微雪的墨水屏驱动库下载</a>)</li></ul><p><code>Arduino</code>库所在的文件夹：</p><img src="D:\qiany\blog_pictures\002\03.png" alt="03" style="zoom:50%"><h3 id="2-2-心知天气库的使用"><a href="#2-2-心知天气库的使用" class="headerlink" title="2.2 心知天气库的使用"></a>2.2 心知天气库的使用</h3><p>先在 <a target="_blank" rel="noopener" href="https://www.seniverse.com/">心知天气</a> 中注册开发者，用免费版，在控制台中获取密钥。</p><p>安装完 <code>ESP8266-Seniverse</code> 库后</p><p>对<code>\Arduino\libraries\ESP8266-Seniverse\src</code>中<code>Forecast.cpp</code>进行修改，在<code>24</code>行左右，<code>&amp;language=en</code>改成<code>&amp;language=zh-Hans</code>，即可输出中文，其他同理。</p><h3 id="2-3-微雪驱动库的使用注意点"><a href="#2-3-微雪驱动库的使用注意点" class="headerlink" title="2.3 微雪驱动库的使用注意点"></a>2.3 微雪驱动库的使用注意点</h3><p>该库将屏幕一分为二，即<strong>上下</strong>两半，<em>超出屏幕范围会报错</em>，即两块400*150的屏幕</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Paint_DrawLine(x_start, y_start, x_end, y_end, BLACK, DOT_PIXEL_1X1, LINE_STYLE_SOLID);  <span class="comment">//画线</span></span><br><span class="line">Paint_DrawRectangle(x_start, y_start, x_end, y_end, BLACK, DOT_PIXEL_1X1, DRAW_FILL_FULL);  <span class="comment">//画矩形</span></span><br><span class="line">Paint_DrawString_CN(x, y, <span class="string">&quot;TEXT&quot;</span>, &amp;Font12CN, BLACK, WHITE);  <span class="comment">// 写字（中文）</span></span><br><span class="line">Paint_DrawString_CN(x, y, <span class="string">&quot;TEXT&quot;</span>, &amp;Font16, WHITE, BLACK);  <span class="comment">// 写字（英文），注意中英文字体颜色顺序反的</span></span><br></pre></td></tr></table></figure><p>其他可以查看<code>\Arduino\libraries\esp8266-waveshare-epd\src\GUI_Paint.cpp</code>的文件</p><h3 id="2-4-字库"><a href="#2-4-字库" class="headerlink" title="2.4 字库"></a>2.4 字库</h3><p>在<code>\Arduino\libraries\esp8266-waveshare-epd\src</code>目录下编辑字库</p><p>该目录下文件构成如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line"> ⊦-utility</span><br><span class="line"> ⊦-DEV_Config.cpp</span><br><span class="line"> ⊦-DEV_Config.h</span><br><span class="line"> ⊦-EPD.h</span><br><span class="line"> ⊦-font8.cpp</span><br><span class="line"> ⊦-font12.cpp</span><br><span class="line"> ⊦-font12CN.c</span><br><span class="line"> ⊦-font16.cpp</span><br><span class="line"> ⊦-font20.cpp  (感觉这些英文字库没啥用，删了)</span><br><span class="line"> ⊦-font24CN.c  (没用的字就删了吧)</span><br><span class="line"> ⊦-fonts.h  (需要修改)</span><br><span class="line"> ⊦-GUI_Paint.cpp</span><br><span class="line"> ⊦-GUI_Paint.h</span><br></pre></td></tr></table></figure><p><code>font&#123;num&#125;.cpp</code>是英文字符，<code>font&#123;num&#125;CN.c</code>是中文字库，根据需要进行删改，建议尽量减少字符数。</p><p>增删字库需要修改<code>fonts.h</code>，按照它的格式写就行。</p><p>然后参考原有字库的形式，创建其他文件，写不同大小的文字，也可以将图标作为字库写进去，个人采取这个方法。</p><p><strong>似乎有更好的对文字和图片的处理方法，但我懒得去找了。</strong></p><p>汉字取模原理</p><p><img src="https://pic.imgdb.cn/item/611f1c204907e2d39cc4cadf.png" alt="02_取模"></p><p>大致过程（此处以“你”为例）：如图，文字宽度必须为8的倍数，不足用“0”补齐，高度任意。将文字如图切割，每8个像素为一组，黑色取1，白色取0，然后对这8个数字转化成16进制，最后连成一段数组。</p><p>不过汉字取模有现成的工具 <code>zimo221</code> ，通过这个软件对需要的文字和图片进行取模，网上应该有，找不到可以从这里<a target="_blank" rel="noopener" href="https://znluckye.lanzoui.com/i00FLsvw03e">直接下载</a>。</p><p>天气图片来自隔壁<code>和风天气</code>的黑白图标集：<a target="_blank" rel="noopener" href="https://github.com/qwd/WeatherIcon">Github链接</a></p><p>通过上述原理，通过简单的python程序，批量对图片处理、取模，得到天气图标，然后给图标随便取个名字，把他当成字库写进去。</p><p>以下为<code>python</code>代码，写的很烂，或许以后系统学编程的时候会笑出来吧–&lt;-&lt;-&lt;@</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  <span class="comment"># 使用PIL处理图片</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span>(<span class="params">num</span>):</span>  <span class="comment"># 图片处理</span></span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">f&quot;WeatherIcon-master\weather-icon-S1\sa\\<span class="subst">&#123;num&#125;</span>.png&quot;</span>)  <span class="comment"># 路径</span></span><br><span class="line">    img1 = img.resize((<span class="number">48</span>, <span class="number">48</span>))  <span class="comment"># 图片目标大小</span></span><br><span class="line">    </span><br><span class="line">    img2 = img1.load()  <span class="comment"># 将图片转换成数组</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 后续操作仅限灰度图片，彩色图片需要改代码</span></span><br><span class="line">    img3 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">            <span class="keyword">if</span> img2[i, j] &gt;= <span class="number">50</span>:  <span class="comment"># 将灰度值&gt;50的当作黑色，否则是白色</span></span><br><span class="line">                img3 += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                img3 += <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">    img4 = []  <span class="comment"># 将数组转成16进制数组</span></span><br><span class="line">    line = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> img3:</span><br><span class="line">        line += i</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line) &gt;= <span class="number">8</span>:</span><br><span class="line">            temp = <span class="built_in">hex</span>(<span class="built_in">int</span>(line, <span class="number">2</span>))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(temp) &lt; <span class="number">4</span>:</span><br><span class="line">                temp = <span class="string">&#x27;0x0&#x27;</span> + temp[-<span class="number">1</span>]  <span class="comment">#处理只有三位长度的数</span></span><br><span class="line">            img4.append(temp)</span><br><span class="line">            line = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> img4</span><br><span class="line"></span><br><span class="line">newName = <span class="string">&#x27;晴暗阵云雨尘风雾飓热冷未&#x27;</span>  <span class="comment"># 随便取个名字</span></span><br><span class="line">oldName = [<span class="number">100</span>, <span class="number">104</span>, <span class="number">300</span>, <span class="number">102</span>, <span class="number">303</span>, <span class="string">&#x27;......&#x27;</span>]  <span class="comment"># 自己去图标库挑几个喜欢的吧，链接在上面</span></span><br><span class="line"></span><br><span class="line">alls = <span class="string">&#x27;&#x27;</span>  <span class="comment"># 最终返回内容</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(oldName)):  <span class="comment"># 按照字库格式输出</span></span><br><span class="line">    alls += <span class="string">&#x27;&#123;&quot;&#x27;</span> + newName[i] + <span class="string">&#x27;&quot;, &#x27;</span></span><br><span class="line">    img5 = process(oldName[i])   <span class="comment"># 调用处理函数</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> img5:</span><br><span class="line">        alls += <span class="built_in">str</span>(j) + <span class="string">&#x27;, &#x27;</span></span><br><span class="line">    alls += <span class="string">&#x27;&#125;,\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(alls)</span><br></pre></td></tr></table></figure><h3 id="2-5-主程序"><a href="#2-5-主程序" class="headerlink" title="2.5 主程序"></a>2.5 主程序</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DEV_Config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;EPD.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;GUI_Paint.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266_Seniverse.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avr/pgmspace.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;NTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 课程表</span></span><br><span class="line"><span class="keyword">const</span> byte subjects[<span class="number">6</span>][<span class="number">11</span>] PROGMEM = &#123;</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;QAQ&quot;</span>;  <span class="comment">// WiFi账号</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;QAQ&quot;</span>;  <span class="comment">// WiFi密码</span></span><br><span class="line"></span><br><span class="line">Forecast forecast;</span><br><span class="line">WiFiUDP ntpUDP;</span><br><span class="line"></span><br><span class="line"><span class="function">NTPClient <span class="title">timeClient</span><span class="params">(ntpUDP, <span class="string">&quot;ntp1.aliyun.com&quot;</span>, <span class="number">28800</span>, <span class="number">1800000</span>)</span></span>;  <span class="comment">//NTP获取时间，阿里云的服务器</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">timeInfo</span>;</span></span><br><span class="line"><span class="keyword">char</span>* nowWeek = <span class="string">&quot;星期零&quot;</span>;</span><br><span class="line">byte nowWeekNum = <span class="number">0</span>; <span class="comment">//周一为0</span></span><br><span class="line"><span class="keyword">int</span> countDown = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> isRefresh = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">bool</span> wifiState = <span class="literal">false</span>;</span><br><span class="line">byte failCounter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>();</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line">  <span class="built_in">ConnectWiFi</span>();</span><br><span class="line">  <span class="keyword">if</span>(wifiState)&#123;</span><br><span class="line">    <span class="built_in">timeUpdate</span>();</span><br><span class="line">    forecast.<span class="built_in">config</span>(<span class="string">&quot;密钥&quot;</span>, <span class="string">&quot;Nantong&quot;</span>, <span class="string">&quot;c&quot;</span>);  <span class="comment">//密钥，地区（拼音即可），格式（&quot;c&quot;为摄氏度）</span></span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(isRefresh) <span class="built_in">pageHome</span>();</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">5000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ESP.<span class="built_in">deepSleep</span>(<span class="number">4e9</span>);  <span class="comment">// 睡眠约1.1h，单位为μs，最大填 4294967295</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 没有循环部分程序，但别删</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接WiFi</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ConnectWiFi</span><span class="params">()</span></span>&#123;</span><br><span class="line">  WiFi.<span class="built_in">mode</span>(WIFI_STA);</span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;Connecting to &quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(ssid);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED &amp;&amp; (i &lt; <span class="number">10</span>)) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (i == <span class="number">20</span>) &#123; <span class="comment">// 10s失败</span></span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Failed&quot;</span>);</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">if</span>(failCounter &lt;= <span class="number">10</span>)&#123;  <span class="comment">// 重试10次</span></span><br><span class="line">      failCounter ++;</span><br><span class="line">      <span class="built_in">ConnectWiFi</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 成功</span></span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;IP address:   &quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(WiFi.<span class="built_in">localIP</span>());</span><br><span class="line">    failCounter = <span class="number">0</span>;</span><br><span class="line">    wifiState = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取日期</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getWeek</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in"><span class="keyword">switch</span></span>(timeInfo -&gt; tm_wday)&#123;  <span class="comment">//日期，方便后续处理（写那么乱，其实就是懒得动脑子）</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: nowWeek = <span class="string">&quot;星期天&quot;</span>;nowWeekNum=<span class="number">7</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: nowWeek = <span class="string">&quot;星期一&quot;</span>;nowWeekNum=<span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: nowWeek = <span class="string">&quot;星期二&quot;</span>;nowWeekNum=<span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: nowWeek = <span class="string">&quot;星期三&quot;</span>;nowWeekNum=<span class="number">2</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: nowWeek = <span class="string">&quot;星期四&quot;</span>;nowWeekNum=<span class="number">3</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: nowWeek = <span class="string">&quot;星期五&quot;</span>;nowWeekNum=<span class="number">4</span>;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: nowWeek = <span class="string">&quot;星期六&quot;</span>;nowWeekNum=<span class="number">5</span>;<span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕刷新</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pageHome</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(forecast.<span class="built_in">update</span>())&#123;  <span class="comment">// 获取天气</span></span><br><span class="line">    String tempStr;  <span class="comment">// 临时文本</span></span><br><span class="line">    </span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;EPD_4IN2B_V2_test Demo\r\n&quot;</span>);</span><br><span class="line">    <span class="built_in">DEV_Module_Init</span>();</span><br><span class="line">  </span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;e-Paper Init and Clear...\r\n&quot;</span>);</span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_Init</span>();</span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_Clear</span>();</span><br><span class="line">    <span class="built_in">DEV_Delay_ms</span>(<span class="number">500</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Create a new image cache named IMAGE_BW and fill it with white</span></span><br><span class="line">    UBYTE *Image; <span class="comment">// black \Red or Yellow</span></span><br><span class="line">    UWORD Imagesize = ((EPD_4IN2B_V2_WIDTH % <span class="number">8</span> == <span class="number">0</span>) ? (EPD_4IN2B_V2_WIDTH / <span class="number">8</span> ) : (EPD_4IN2B_V2_WIDTH / <span class="number">8</span> + <span class="number">1</span>)) * EPD_4IN2B_V2_HEIGHT;</span><br><span class="line">    <span class="keyword">if</span> ((Image = (UBYTE *)<span class="built_in">malloc</span>(Imagesize / <span class="number">2</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Failed to apply for half memory...\r\n&quot;</span>);</span><br><span class="line">      <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;NewImage:BlackImage and RYImage\r\n&quot;</span>);</span><br><span class="line">    <span class="built_in">Paint_NewImage</span>(Image, EPD_4IN2B_V2_WIDTH, EPD_4IN2B_V2_HEIGHT / <span class="number">2</span>, <span class="number">0</span>, WHITE);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//Select Image</span></span><br><span class="line">    <span class="built_in">Paint_SelectImage</span>(Image);</span><br><span class="line">    <span class="built_in">Paint_Clear</span>(WHITE);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//--黑--</span></span><br><span class="line">    <span class="comment">// 上半部分</span></span><br><span class="line">    <span class="built_in">Paint_Clear</span>(WHITE);</span><br><span class="line">    <span class="comment">//header</span></span><br><span class="line">    <span class="built_in">Paint_DrawRectangle</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">24</span>, BLACK, DOT_PIXEL_1X1, DRAW_FILL_FULL);</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">5</span>, <span class="number">1</span>, <span class="string">&quot;(^_^)&quot;</span>, &amp;Font16, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">80</span>, <span class="number">1</span>, <span class="string">&quot;更新时间：&quot;</span>, &amp;Font12CN, WHITE, BLACK);</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">155</span>, <span class="number">3</span>, forecast.<span class="built_in">getLastUpdate</span>().<span class="built_in">substring</span>(<span class="number">11</span>, <span class="number">16</span>).<span class="built_in">c_str</span>(), &amp;Font16, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawRectangle</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">400</span>, <span class="number">24</span>, WHITE, DOT_PIXEL_1X1, DRAW_FILL_FULL);</span><br><span class="line">    <span class="keyword">if</span>(wifiState) <span class="built_in">Paint_DrawString_EN</span>(<span class="number">350</span>, <span class="number">3</span>, <span class="string">&quot;WiFi&quot;</span>, &amp;Font16, BLACK, WHITE);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//Left</span></span><br><span class="line">    tempStr = (String)(timeInfo -&gt; tm_mon + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(timeInfo -&gt; tm_mon &lt; <span class="number">9</span>) tempStr = <span class="string">&quot;0&quot;</span> + tempStr;</span><br><span class="line">    <span class="comment">//Serial.println(tempStr);</span></span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">20</span>, <span class="number">45</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font24N, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">50</span>, <span class="number">45</span>, <span class="string">&quot;月&quot;</span>, &amp;Font24CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)(timeInfo -&gt; tm_mday);</span><br><span class="line">    <span class="keyword">if</span>(timeInfo -&gt; tm_mday &lt; <span class="number">10</span>) tempStr = <span class="string">&quot;0&quot;</span> + tempStr;</span><br><span class="line">    <span class="comment">//Serial.println(tempStr);</span></span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">80</span>, <span class="number">45</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font24N, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">110</span>, <span class="number">45</span>, <span class="string">&quot;日&quot;</span>, &amp;Font24CN, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">52</span>, <span class="number">88</span>, nowWeek, &amp;Font12CN, BLACK, WHITE);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawRectangle</span>(<span class="number">0</span>, <span class="number">132</span>, <span class="number">160</span>, <span class="number">150</span>, BLACK, DOT_PIXEL_1X1, DRAW_FILL_FULL);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">45</span>, <span class="number">132</span>, <span class="string">&quot;天气预报&quot;</span>, &amp;Font12CN, WHITE, BLACK);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>, <span class="number">56</span>, <span class="string">&quot;距离高考还剩         天&quot;</span>, &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawLine</span>(<span class="number">165</span>, <span class="number">20</span>, <span class="number">165</span>, <span class="number">150</span>, BLACK, DOT_PIXEL_1X1, LINE_STYLE_SOLID);</span><br><span class="line">    <span class="built_in">Paint_DrawRectangle</span>(<span class="number">170</span>, <span class="number">79</span>, <span class="number">395</span>, <span class="number">99</span>, BLACK, DOT_PIXEL_1X1, DRAW_FILL_FULL);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* week[<span class="number">6</span>] = &#123;<span class="string">&quot;周一&quot;</span>, <span class="string">&quot;周二&quot;</span>, <span class="string">&quot;周三&quot;</span>, <span class="string">&quot;周四&quot;</span>, <span class="string">&quot;周五&quot;</span>, <span class="string">&quot;周六&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(byte j=<span class="number">0</span>; j&lt;=<span class="number">5</span>; j++)&#123;</span><br><span class="line">      <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>+j*<span class="number">38</span>, <span class="number">81</span>, week[j], &amp;Font12CN, WHITE, BLACK);</span><br><span class="line">      <span class="keyword">if</span>(j != nowWeekNum)&#123;</span><br><span class="line">        <span class="keyword">for</span>(byte i=<span class="number">0</span>; i&lt;=<span class="number">2</span>; i++)&#123;</span><br><span class="line">          <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>+j*<span class="number">38</span>, <span class="number">99</span>+i*<span class="number">18</span>, <span class="built_in">subject</span>(<span class="built_in">pgm_read_byte</span>(&amp;subjects[j][i])), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_SendHalfBimage</span>(<span class="number">0</span>, Image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下半部分</span></span><br><span class="line">    <span class="built_in">Paint_Clear</span>(WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">weatherI</span>(forecast.<span class="built_in">getDayCode</span>(<span class="number">0</span>)), &amp;Font48GUI, BLACK, WHITE);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">60</span>, <span class="number">5</span>, forecast.<span class="built_in">getDayText</span>(<span class="number">0</span>).<span class="built_in">c_str</span>(), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getLow</span>(<span class="number">0</span>) + <span class="string">&quot;-&quot;</span> + (String)forecast.<span class="built_in">getHigh</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">60</span>, <span class="number">28</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">115</span>, <span class="number">26</span>, <span class="string">&quot;℃&quot;</span>, &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getHumidity</span>(<span class="number">0</span>) + <span class="string">&quot;%  &quot;</span> + (String)forecast.<span class="built_in">getRain</span>(<span class="number">0</span>) + <span class="string">&quot;mm&quot;</span>;</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">5</span>, <span class="number">48</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawLine</span>(<span class="number">5</span>, <span class="number">70</span>, <span class="number">160</span>, <span class="number">70</span>, BLACK, DOT_PIXEL_1X1, LINE_STYLE_SOLID);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">5</span>, <span class="number">75</span>, forecast.<span class="built_in">getDayText</span>(<span class="number">1</span>).<span class="built_in">c_str</span>(), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getLow</span>(<span class="number">1</span>) + <span class="string">&quot;-&quot;</span> + (String)forecast.<span class="built_in">getHigh</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">5</span>, <span class="number">97</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">60</span>, <span class="number">95</span>, <span class="string">&quot;℃&quot;</span>, &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)(<span class="keyword">int</span>)forecast.<span class="built_in">getRain</span>(<span class="number">1</span>) + <span class="string">&quot;mm&quot;</span>;</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">5</span>, <span class="number">112</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getHumidity</span>(<span class="number">1</span>) + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">5</span>, <span class="number">129</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawLine</span>(<span class="number">80</span>, <span class="number">75</span>, <span class="number">80</span>, <span class="number">150</span>, BLACK, DOT_PIXEL_1X1, LINE_STYLE_SOLID);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">85</span>, <span class="number">75</span>, forecast.<span class="built_in">getDayText</span>(<span class="number">2</span>).<span class="built_in">c_str</span>(), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getLow</span>(<span class="number">2</span>) + <span class="string">&quot;-&quot;</span> + (String)forecast.<span class="built_in">getHigh</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">85</span>, <span class="number">97</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">140</span>, <span class="number">95</span>, <span class="string">&quot;℃&quot;</span>, &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)(<span class="keyword">int</span>)forecast.<span class="built_in">getRain</span>(<span class="number">2</span>) + <span class="string">&quot;mm&quot;</span>;</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">85</span>, <span class="number">112</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line">    tempStr = (String)forecast.<span class="built_in">getHumidity</span>(<span class="number">2</span>) + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">    <span class="built_in">Paint_DrawString_EN</span>(<span class="number">85</span>, <span class="number">129</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font16, WHITE, BLACK);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_DrawLine</span>(<span class="number">165</span>, <span class="number">0</span>, <span class="number">165</span>, <span class="number">150</span>, BLACK, DOT_PIXEL_1X1, LINE_STYLE_SOLID);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(byte j=<span class="number">0</span>; j&lt;=<span class="number">5</span>; j++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(j != nowWeekNum)&#123;</span><br><span class="line">        <span class="keyword">for</span>(byte i=<span class="number">3</span>; i&lt;=<span class="number">10</span>; i++)&#123;</span><br><span class="line">          <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>+j*<span class="number">38</span>, (i<span class="number">-3</span>)*<span class="number">18</span>+<span class="number">3</span>, <span class="built_in">subject</span>(<span class="built_in">pgm_read_byte</span>(&amp;subjects[j][i])), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_SendHalfBimage</span>(<span class="number">1</span>, Image);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//--红--</span></span><br><span class="line">    <span class="comment">//Serial.println(&quot;Draw red image\r\n&quot;);</span></span><br><span class="line">    <span class="built_in">Paint_Clear</span>(WHITE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//header</span></span><br><span class="line">    <span class="keyword">if</span>(!wifiState) <span class="built_in">Paint_DrawString_EN</span>(<span class="number">350</span>, <span class="number">3</span>, <span class="string">&quot;WiFi&quot;</span>, &amp;Font16, WHITE, BLACK);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//倒计时</span></span><br><span class="line">    tempStr = (String)(<span class="keyword">int</span>)(countDown / <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">284</span>, <span class="number">32</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font48N, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)(<span class="keyword">int</span>)((countDown % <span class="number">100</span>) / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">312</span>, <span class="number">32</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font48N, BLACK, WHITE);</span><br><span class="line">    tempStr = (String)(<span class="keyword">int</span>)((countDown % <span class="number">100</span>) % <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">Paint_DrawString_CN</span>(<span class="number">340</span>, <span class="number">32</span>, tempStr.<span class="built_in">c_str</span>(), &amp;Font48N, BLACK, WHITE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//table</span></span><br><span class="line">    <span class="keyword">if</span>(nowWeekNum != <span class="number">7</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>(byte i=<span class="number">0</span>; i&lt;=<span class="number">2</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>+nowWeekNum*<span class="number">38</span>, <span class="number">98</span>+i*<span class="number">18</span>, <span class="built_in">subject</span>(<span class="built_in">pgm_read_byte</span>(&amp;subjects[nowWeekNum][i])), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_SendHalfRYimage</span>(<span class="number">0</span>, Image);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Paint_Clear</span>(WHITE);</span><br><span class="line">    <span class="keyword">if</span>(nowWeekNum != <span class="number">7</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>(byte i=<span class="number">3</span>; i&lt;=<span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">Paint_DrawString_CN</span>(<span class="number">172</span>+nowWeekNum*<span class="number">38</span>, (i<span class="number">-3</span>)*<span class="number">18</span>+<span class="number">3</span>, <span class="built_in">subject</span>(<span class="built_in">pgm_read_byte</span>(&amp;subjects[nowWeekNum][i])), &amp;Font12CN, BLACK, WHITE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_SendHalfRYimage</span>(<span class="number">1</span>, Image);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//Serial.println(&quot;EPD_Display\r\n&quot;);</span></span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_TurnOnDisplay</span>();</span><br><span class="line">    <span class="built_in">DEV_Delay_ms</span>(<span class="number">2000</span>);</span><br><span class="line">  </span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Goto Sleep...\r\n&quot;</span>);</span><br><span class="line">    <span class="built_in">EPD_4IN2B_V2_Sleep</span>();</span><br><span class="line">    <span class="built_in">free</span>(Image);</span><br><span class="line">    Image = <span class="literal">NULL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">weatherI</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">  <span class="built_in"><span class="keyword">switch</span></span>(id)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> <span class="string">&quot;晴&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">case</span> <span class="number">9</span>: <span class="keyword">return</span> <span class="string">&quot;云&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: <span class="keyword">case</span> <span class="number">6</span>: <span class="keyword">case</span> <span class="number">7</span>: <span class="keyword">case</span> <span class="number">8</span>: <span class="keyword">return</span> <span class="string">&quot;暗&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>: <span class="keyword">case</span> <span class="number">11</span>: <span class="keyword">case</span> <span class="number">12</span>: <span class="keyword">case</span> <span class="number">21</span>: <span class="keyword">return</span> <span class="string">&quot;阵&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">13</span>: <span class="keyword">case</span> <span class="number">14</span>: <span class="keyword">case</span> <span class="number">15</span>: <span class="keyword">case</span> <span class="number">16</span>: <span class="keyword">case</span> <span class="number">17</span>: <span class="keyword">case</span> <span class="number">18</span>: <span class="keyword">case</span> <span class="number">19</span>: <span class="keyword">case</span> <span class="number">20</span>: <span class="keyword">case</span> <span class="number">22</span>: <span class="keyword">case</span> <span class="number">23</span>: <span class="keyword">case</span> <span class="number">24</span>: <span class="keyword">case</span> <span class="number">25</span>: <span class="keyword">return</span> <span class="string">&quot;雨&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">26</span>: <span class="keyword">case</span> <span class="number">27</span>: <span class="keyword">case</span> <span class="number">28</span>: <span class="keyword">case</span> <span class="number">29</span>: <span class="keyword">return</span> <span class="string">&quot;尘&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">30</span>: <span class="keyword">case</span> <span class="number">31</span>: <span class="keyword">return</span> <span class="string">&quot;雾&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">32</span>: <span class="keyword">case</span> <span class="number">33</span>: <span class="keyword">return</span> <span class="string">&quot;风&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">34</span>: <span class="keyword">case</span> <span class="number">35</span>: <span class="keyword">case</span> <span class="number">36</span>: <span class="keyword">return</span> <span class="string">&quot;飓&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">37</span>: <span class="keyword">return</span> <span class="string">&quot;冷&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">38</span>: <span class="keyword">return</span> <span class="string">&quot;热&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">99</span>: <span class="keyword">return</span> <span class="string">&quot;未&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 课程表</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">subject</span><span class="params">(byte id)</span></span>&#123;</span><br><span class="line">  <span class="built_in"><span class="keyword">switch</span></span>(id)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="string">&quot;无&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="string">&quot;语文&quot;</span>;	<span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="string">&quot;数学&quot;</span>;	<span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> <span class="string">&quot;英语&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">return</span> <span class="string">&quot;物理&quot;</span>;	<span class="keyword">case</span> <span class="number">5</span>: <span class="keyword">return</span> <span class="string">&quot;化学&quot;</span>;	<span class="keyword">case</span> <span class="number">6</span>: <span class="keyword">return</span> <span class="string">&quot;地理&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>: <span class="keyword">return</span> <span class="string">&quot;自习&quot;</span>;	<span class="keyword">case</span> <span class="number">8</span>: <span class="keyword">return</span> <span class="string">&quot;阅读&quot;</span>;	<span class="keyword">case</span> <span class="number">9</span>: <span class="keyword">return</span> <span class="string">&quot;听力&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">timeUpdate</span><span class="params">()</span></span>&#123;  <span class="comment">// 时间更新</span></span><br><span class="line">  timeClient.<span class="built_in">update</span>();</span><br><span class="line">  countDown = (<span class="number">1654617599</span> - (timeClient.<span class="built_in">getEpochTime</span>() - <span class="number">28800</span>)) / <span class="number">86400</span>;</span><br><span class="line">  <span class="comment">//if((count - (int)count) &gt; 0) countDown++;</span></span><br><span class="line">  <span class="keyword">if</span>(countDown &gt;= <span class="number">350</span>)&#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(failCounter &lt;= <span class="number">30</span>)&#123;</span><br><span class="line">      failCounter ++;</span><br><span class="line">      <span class="built_in">timeUpdate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(countDown);</span><br><span class="line">    Serial.<span class="built_in">println</span>(timeClient.<span class="built_in">getEpochTime</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">time_t</span> rawtime = timeClient.<span class="built_in">getEpochTime</span>();</span><br><span class="line">    timeInfo = <span class="built_in">gmtime</span>(&amp;rawtime);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">getWeek</span>();</span><br><span class="line">    Serial.<span class="built_in">println</span>(nowWeek);</span><br><span class="line">    </span><br><span class="line">    failCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(countDown &lt; <span class="number">0</span>) countDown = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>((timeClient.<span class="built_in">getHours</span>()&gt;<span class="number">0</span> &amp;&amp; timeClient.<span class="built_in">getHours</span>()&lt;<span class="number">4</span>) || (timeClient.<span class="built_in">getHours</span>()&gt;<span class="number">9</span> &amp;&amp; timeClient.<span class="built_in">getHours</span>()&lt;<span class="number">17</span>)) isRefresh = <span class="literal">false</span>;  <span class="comment">// 设置不刷新的时间，节约用电</span></span><br><span class="line">    Serial.<span class="built_in">println</span>(isRefresh);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-实物制作"><a href="#3-实物制作" class="headerlink" title="3.实物制作"></a>3.实物制作</h2><h3 id="3-1-电路图"><a href="#3-1-电路图" class="headerlink" title="3.1  电路图"></a>3.1 电路图</h3><img src="D:\qiany\blog_pictures\002\04.png" alt="04" style="zoom:67%"><p>该电路用于ESP8266睡眠后自动唤醒，加一个开关是因为D0和RST短接时，无法正常烧录程序，为了后续方便更新程序，所以加个开关。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E9%AB%98%E4%B8%AD/" rel="tag"># 高中</a> <a href="/tags/DIY/" rel="tag"># DIY</a> <a href="/tags/%E6%95%99%E7%A8%8B/" rel="tag"># 教程</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/archives/e2c74d5c.html/" rel="prev" title="密码测试"><i class="fa fa-chevron-left"></i> 密码测试</a></div><div class="post-nav-item"></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88"><span class="nav-number">1.</span> <span class="nav-text">0.效果预览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%9D%90%E6%96%99"><span class="nav-number">2.</span> <span class="nav-text">1.材料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%BB%A3%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">2.代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%BA%93"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%BF%83%E7%9F%A5%E5%A4%A9%E6%B0%94%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 心知天气库的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%BE%AE%E9%9B%AA%E9%A9%B1%E5%8A%A8%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 微雪驱动库的使用注意点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%AD%97%E5%BA%93"><span class="nav-number">3.4.</span> <span class="nav-text">2.4 字库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E4%B8%BB%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.5.</span> <span class="nav-text">2.5 主程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%9E%E7%89%A9%E5%88%B6%E4%BD%9C"><span class="nav-number">4.</span> <span class="nav-text">3.实物制作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%94%B5%E8%B7%AF%E5%9B%BE"><span class="nav-number">4.1.</span> <span class="nav-text">3.1 电路图</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">ZnLuckyE</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ZnLuckyE" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZnLuckyE" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">ZnLuckyE</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">18k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">17 分钟</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动</div><script>(function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"m5ow1hbxjDJYTIykdyOanglO-gzGzoHsz","app_key":"sEyCRCKRYqhGh0SUv8gcEn8A","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script></body></html>